clc;
clear;
close all;
[fname, pathname] = uigetfile('*.dat', 'Select a leapmotion data file');
if (fname == 0)
    return;
end
filePath = [pathname fname];


dataFileID = fopen(filePath);


fileInfo = dir(filePath); % File info
fileSize = fileInfo.bytes; % File size

frameNumber = fileSize/912;

%index_distal_BH_container = zeros(frameNumber, 3); % (frameNumber, [x y z])
w = zeros(frameNumber, 3);
elbow_hand = zeros(frameNumber, 25);

%Thumb_M_BB= zeros(frameNumber,3); 

for frameIndex = 1:10
    % Each loop cycle corresponds to a frame (sent by the leapmotion to the PC)
    
    trackingFrameId = fread(dataFileID, 1, 'int64');
    framerate = fread(dataFileID, 1, 'float');
    
    info_frameId = fread(dataFileID, 1, 'int64');
    info_timestamp = fread(dataFileID, 1, 'int64');
    
    hand_id = fread(dataFileID, 1, 'uint32');
    hand_pinchDistance = fread(dataFileID, 1, 'float');
    hand_grabAngle = fread(dataFileID, 1, 'float');
    hand_pinchStrength = fread(dataFileID, 1, 'float');
    hand_grabStrength = fread(dataFileID, 1, 'float');
    
    hand_arm_prevJoint_x = fread(dataFileID, 1, 'float');
    hand_arm_prevJoint_y = fread(dataFileID, 1, 'float');
    hand_arm_prevJoint_z = fread(dataFileID, 1, 'float');
    
    hand_arm_nextJoint_x = fread(dataFileID, 1, 'float');
    hand_arm_nextJoint_y = fread(dataFileID, 1, 'float');
    hand_arm_nextJoint_z = fread(dataFileID, 1, 'float');
    
    hand_arm_rotation_x = fread(dataFileID, 1, 'float');
    hand_arm_rotation_y = fread(dataFileID, 1, 'float');
    hand_arm_rotation_z = fread(dataFileID, 1, 'float');
    hand_arm_rotation_w = fread(dataFileID, 1, 'float');
    
    hand_palm_position_x = fread(dataFileID, 1, 'float');
    hand_palm_position_y = fread(dataFileID, 1, 'float');
    hand_palm_position_z = fread(dataFileID, 1, 'float');
    
    hand_palm_direction_x = fread(dataFileID, 1, 'float');
    hand_palm_direction_y = fread(dataFileID, 1, 'float');
    hand_palm_direction_z = fread(dataFileID, 1, 'float');
    
    % For each digits (thumb index middle ring pinky)
    for i = 1:5
        
        % For each bones (metacarpal proximal intermediate distal)
        for j = 1:4
            
            % The base of the bone, closer to the heart
            prevJoint_x = fread(dataFileID, 1, 'float');
            prevJoint_y = fread(dataFileID, 1, 'float');
            prevJoint_z = fread(dataFileID, 1, 'float');
            
            % The end of the bone, further from the heart
            nextJoint_x = fread(dataFileID, 1, 'float');
            nextJoint_y = fread(dataFileID, 1, 'float');
            nextJoint_z = fread(dataFileID, 1, 'float');
            
            % Rotation in world space from the forward direction
            rotation_x = fread(dataFileID, 1, 'float');
            rotation_y = fread(dataFileID, 1, 'float');
            rotation_z = fread(dataFileID, 1, 'float');
            rotation_w = fread(dataFileID, 1, 'float');
            

            % EXAMPLE
            % Here, we only save the head bone 3D position of the distal
            % index bone            
            if ((i == 2) && (j == 4)) % 2: Index / 4: Distal
                index_distal_BH_container(frameIndex, :) = [nextJoint_x nextJoint_y nextJoint_z];
               
                
            end
            if ((i==1)&& (j==1)) % thumb and metacarpal
              
              Thumb_M_BB(frameIndex,:)= [nextJoint_x nextJoint_y nextJoint_z];
              %disp(Thumb_M_BB)
            end
        end  
        
    end
    elbow_hand = [trackingFrameId framerate info_frameId info_timestamp hand_id hand_pinchDistance hand_grabAngle hand_pinchStrength hand_grabStrength hand_arm_nextJoint_x hand_arm_nextJoint_y hand_arm_nextJoint_z hand_arm_prevJoint_x hand_arm_prevJoint_y hand_arm_prevJoint_z hand_arm_rotation_x hand_arm_rotation_y hand_arm_rotation_z hand_arm_rotation_w hand_palm_position_x hand_palm_position_y hand_palm_position_z hand_palm_direction_x hand_palm_direction_y hand_palm_direction_z];
    a=disp(Thumb_M_BB)
    b=disp(index_distal_BH_container)
    
    %disp(elbow)
    %a=elbow(:,6)
    %b=elbow(:,:)
    %disp(a)
    %arr=elbow(1,6);
    
    
    
    %if you give elbow name means the column numbers then i can give the name instead of 6
    %matrix=zeros(10,6)
    %matrix= elbow(1,:)
    %for j=1:10
      %Mat()       
    
    
    %if (frameIndex == 10) 
        
       mat(frameIndex,:)= elbow_hand(1,:)
       
       % final= mat(10,6)
      if (frameIndex == 10)
         a= mat 
      %disp(a)
      % I can call a particular position of the matrix
      %a(1,:)
      
      
        header={'trackingFrameId' ,'framerate', 'info_frameId' ,'info_timestamp' ,'hand_id' ,'hand_pinchDistance', 'hand_grabAngle' ,'hand_pinchStrength', 'hand_grabStrength' ,'hand_arm_nextJoint_x' ,'hand_arm_nextJoint_y', 'hand_arm_nextJoint_z' ,'hand_arm_prevJoint_x' ,'hand_arm_prevJoint_y' ,'hand_arm_prevJoint_z', 'hand_arm_rotation_x', 'hand_arm_rotation_y' ,'hand_arm_rotation_z' ,'hand_arm_rotation_w' ,'hand_palm_position_x' ,'hand_palm_position_y' ,'hand_palm_position_z' ,'hand_palm_direction_x', 'hand_palm_direction_y' ,'hand_palm_direction_z'};
    
        xlswrite('DAT_XLS_all_1.xlsx',header,'DATA','B1')
        xlswrite('DAT_XLS_all_1.xlsx',a(:,:),'DATA','B2')
      endif  
        %for j=1:10
        %disp(mat)
      
    %xlRange = strcat('B3',int2str(j));
        %xlswrite("NEW_EXCEL_4.xlsx",mat(fra,:),'A2',xlRange);
    %endif  %xlswrite("NEW_EXCEL_4.xlsx",header,'A2','B2');
    end
    


fclose(dataFileID);
